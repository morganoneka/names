<!DOCTYPE html>
<meta charset="utf-8">

<head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<style>

</style>

<body>

  <div class="jumbotron text-center">
   <h1>Surnames</h1>
   <p>Let's look at last name y'alllll RIP MongaBay</p>
  </div>

  <div class="container">
   <div class="row">
      <div class="col-sm-12">
        Search Criteria Here
      </div>
    </div>

    <div class="row">
       <div class="col-sm-12">
         <div id="namestable">
         </div>
       </div>
     </div>

     <div class="row">
        <div class="col-sm-12">
          <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center" id="mypagination">
            <!-- <li class="page-item disabled">
              <a class="page-link" href="#" tabindex="-1" id="prev_button" onclick="prev_page();event.preventDefault();">Previous</a>
            </li>
            <li class="page-item"><a class="page-link" href="#" onclick="get_page(this);event.preventDefault();">1</a></li>
            <li class="page-item"><a class="page-link" href="#" onclick="get_page(this);event.preventDefault();">2</a></li>
            <li class="page-item"><a class="page-link" href="#" onclick="get_page(this);event.preventDefault();">3</a></li>
            <li class="page-item">
              <a class="page-link" href="#" id="next_button" onclick="next_page();event.preventDefault();">Next</a>
            </li> -->
          </ul>
        </nav>
        </div>
      </div>
  </div>


  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-array.v2.min.js"></script>

  <script>
    function display_table(data){
      var columns = ['name','rank','count'];

      // if data has more than 50 rows, only display the first 50
      if (data.length > 50){
        data = data.slice(0,50);
      }

      d3.select('#namestable').select('table').remove();
      var table = d3.select('#namestable').append('table').attr('class','table');
      var thead = table.append('thead').attr('class','thead-dark')
      var	tbody = table.append('tbody');

      // append the header row
      thead.append('tr')
        .selectAll('th')
        .data(columns).enter()
        .append('th')
          .text(function (column) { return column; });


      // create a row for each object in the data
      var rows = tbody.selectAll('tr')
        .data(data)
        .enter()
        .append('tr');

      // create a cell in each row for each column
      var cells = rows.selectAll('td')
        .data(function (row) {
          return columns.map(function (column) {
            return {column: column, value: row[column]};
          });
        })
        .enter()
        .append('td')
          .text(function (d) { return d.value; });

      return table;
    }

    function create_pagination(){
      // delete current ul
      var pagination = d3.select('#mypagination')

      pagination.selectAll('li').remove();


      number_of_pages = Math.ceil(my_data.length / 50);

      // previous box
      prev_page_class = 'page-item'
      if (current_page == 1){
        prev_page_class='page-item disabled'
      }

      pagination.append('li').attr('class', prev_page_class).append('a').attr('class', 'page-link').attr('href', "#").attr('onclick', 'prev_page();event.preventDefault();').text('Previous');

      // pages before current page
      start = current_page - 3;

      if (start < 1){
        for (i = 1; i < current_page; i++){
          pagination.append('li').attr('class', 'page-item').append('a').attr('class', 'page-link').attr('href', "#").attr('onclick', 'get_page(this);event.preventDefault();').text(String(i));
        }
      } else
        if (start > 2){
          pagination.append('li').attr('class', 'page-item').append('a').attr('class', 'page-link').attr('href', "#").attr('onclick', 'get_page(this);event.preventDefault();').text("1");
          pagination.append('li').attr('class', 'page-item').append('a').attr('class', 'page-link').text("...");
        for (i = start; i < current_page; i++){
          pagination.append('li').attr('class', 'page-item').append('a').attr('class', 'page-link').attr('href', "#").attr('onclick', 'get_page(this);event.preventDefault();').text(String(i));
        }
      }

      // current_page
      pagination.append('li').attr('class', 'page-item').append('a').attr('class', 'page-link').text(String(current_page));

      // pages after current page
      end = current_page + 4;
      if (end > number_of_pages){
        for (i = (current_page+1); i <= number_of_pages; i++){
          pagination.append('li').attr('class', 'page-item').append('a').attr('class', 'page-link').attr('href', "#").attr('onclick', 'get_page(this);event.preventDefault();').text(String(i));
        }
      } else{
        for (i = (current_page+1); i < end; i++){
          pagination.append('li').attr('class', 'page-item').append('a').attr('class', 'page-link').attr('href', "#").attr('onclick', 'get_page(this);event.preventDefault();').text(String(i));
        }
        if (end <= number_of_pages){
          pagination.append('li').attr('class', 'page-item').append('a').attr('class', 'page-link').text("...");

          pagination.append('li').attr('class', 'page-item').append('a').attr('class', 'page-link').attr('href', "#").attr('onclick', 'get_page(this);event.preventDefault();').text(String(number_of_pages));
        }
      }

      // next box
      next_page_class = 'page-item'
      if (current_page == number_of_pages){
        next_page_class='page-item disabled'
      }

      pagination.append('li').attr('class', next_page_class).append('a').attr('class', 'page-link').attr('href', "#").attr('onclick', 'next_page();event.preventDefault();').text('Next');
    }

    function next_page(){
      // increase current_page
      current_page ++;

      // display the new data
      display_table(my_data.slice((current_page - 1) * 50), current_page*50);
      create_pagination();
    }

    function prev_page(){
      // decrease current_page
      current_page --;

      // display the new data
      display_table(my_data.slice((current_page - 1) * 50), current_page*50);
      create_pagination();
    }

    function get_page(button){
      current_page = parseInt(button.text);

      // display the new data
      display_table(my_data.slice((current_page - 1) * 50), current_page*50);
      create_pagination();
    }

    var my_data = null;
    var current_page = null;

    d3.csv("https://raw.githubusercontent.com/morganoneka/names/main/Names_2010Census.csv?token=GHSAT0AAAAAABRG7LRVO57ODNXVYVQ5E5VAYQPAHZQ", function(data){
      my_data=data;
      current_page=1;
      display_table(my_data);
      create_pagination(my_data);
      next_page();
      next_page();
      next_page();
      next_page();
      next_page();
      next_page();
    });

  </script>
</body>
